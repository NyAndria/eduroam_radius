- name: Make sure Python2 is available
  hosts: idp
  become: True
  gather_facts: False
  tasks:
    - raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)

- name: Install eduroam Identity Provider
  hosts: idp
  become: True
  gather_facts: True
  vars_files:
    - group_vars/secrets.yml
  roles:
    - freeradius
    - { role: eapol_test, when: play_eapol == True }
    
  handlers:
    - name: restart freeradius
      service: name=freeradius state=restarted


# - name: Install NewRelic
#   hosts: idp
#   become: True
#   roles:
#     - { role: franklinkim.newrelic, when: play_newrelic == True }
#   vars_files:
#     - group_vars/secrets.yml
#   vars:
#     newrelic_service_state: started

